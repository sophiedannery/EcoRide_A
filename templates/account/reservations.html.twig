{# templates/account/trajet_new.html.twig #}
{% extends 'base.html.twig' %}
{% block title %}Mes réservations
{% endblock %}

{% block body %}


<div class="card text-center">
	<div class="card-header">
		<ul class="nav nav-tabs card-header-tabs">
			<li class="nav-item">
				<a class="nav-link" href="{{ path ('app_account') }}">Mon profil</a>
			</li>
			<li class="nav-item">
				<a class="nav-link active" aria-current="true" href="#">Mes réservations</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="{{ path ('app_account_trajets') }}">Mes trajets</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="{{ path ('app_account_vehicules') }}">Mes véhicules</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="{{ path ('app_account_preferences') }}">Mes préférences</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="{{ path ('app_account_statut') }}">Mon statut</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="{{ path ('app_account_avis') }}">Mes avis</a>
			</li>
		</ul>
	</div>
	<div class="card-body">
		<h5 class="card-title">Mes réservations en tant que passager</h5>
		{% if history is empty %}
			<p>Vous n'avez aucune réservation pour le moment.</p>
		{% else %}

			<table class="table table-striped">
				<thead>
					<tr>
						<th>Trajet</th>
						<th>Date de départ</th>
						<th>Statut</th>
						<th>Crédits utilisés</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for r in history %}
						<tr>
							<td>
								{{ r.adresse_depart }}
								→
								{{ r.adresse_arrivee }}
								<br>
								Chauffeur :
								{{ r.chauffeur_pseudo }}
							</td>
							<td>{{ r.date_depart|date('d/m/Y H:i') }}</td>
							<td>{{ r.reservation_statut }}</td>
							<td>{{ r.credits_utilises }}</td>
							<td>
								{% if r.reservation_statut == 'confirmée' and r.statut_trajet != 'en_cours' and r.statut_trajet != 'terminé' %}
									<form method='post' action="{{ path('app_reservation_annuler', {'id': r.reservation_id}) }}" onsubmit="return confirm('Voulez-vous vraiment annuler cette réservation ?')">
										<input type="hidden" name="_token" value="{{ csrf_token('cancel_reservation' ~ r.reservation_id) }}">
										<button class="btn btn-sm btn-danger">Annuler</button>
									</form>
								{% endif %}


								{% if r.reservation_statut == 'confirmée' and r.statut_trajet == 'terminé' %}

									<a href="{{ path('app_reservation_resume', {'id': r.reservation_id}) }}" class="btn btn-sm btn-success">Valider le trajet</a>

								{% endif %}

								{% if r.statut_trajet == 'validé' %}
									<button class="btn btn-sm btn-success disabled">Trajet terminé</button>
								{% endif %}

								{% if r.reservation_statut == 'signalé' %}
									<button class="btn btn-sm btn-warning disabled">Trajet signalé</button>
								{% endif %}

								{% if r.statut_trajet == 'validé' and not r.avis %}
									<a href="{{ path('app_avis_new', {'reservationId': r.reservation_id}) }}" class="btn btn-sm btn-success">Laisser un avis</a>
								{% endif %}
							</td>
						</tr>
					</td>
				</tbody>
			</tr>
		{% endfor %}
	</tbody>
</table>{% endif %}<a href="{{ path('app_rides')}}" class="btn btn-success mb-4">Rechercher un trajet</a></div></div>{% endblock %}
